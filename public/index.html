<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
    <title>Pokémon TCG Finder</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; padding-top: 20px; }
        .card-container { transition: transform 0.2s; cursor: pointer; height: 100%; }
        .card-container:hover { transform: scale(1.03); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .card-img-top { border-radius: 8px; background: #eee; min-height: 200px; }
        .badge-type { font-size: 0.7rem; margin-right: 5px; }
        #loading-spinner { display: none; }
        .modal-body img { max-width: 100%; border-radius: 10px; margin-bottom: 15px; }
    </style>
</head>
<body>

<div class="container">
    <div class="row justify-content-center mb-4">
        <div class="col-md-8 text-center">
            <h1 class="mb-4">Pokémon TCG Checklist</h1>
            <div class="input-group">
                <input type="text" id="search-input" class="form-control" placeholder="Ej: Pikachu, Charizard, Mew...">
                <button class="btn btn-primary" id="search-btn">Buscar Carta</button>
            </div>
            <div id="loading-spinner" class="mt-3">
                <div class="spinner-border text-primary" role="status"></div>
            </div>
        </div>
    </div>

    <div class="row row-cols-2 row-cols-md-4 row-cols-lg-6 g-3" id="results-grid">
        </div>
</div>

<div class="modal fade" id="cardModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTitle">Detalles de la Carta</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center" id="modalBody">
                </div>
            <div class="modal-footer">
                <a href="#" id="price-btn" target="_blank" class="btn btn-success w-100">Ver precio en Cardmarket</a>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const API_URL = 'https://api.tcgdex.net/v2/es';
    const grid = document.getElementById('results-grid');
    const spinner = document.getElementById('loading-spinner');
    const modal = new bootstrap.Modal(document.getElementById('cardModal'));

    async function fetchCards(name = '') {
        grid.innerHTML = '';
        spinner.style.display = 'block';
        
        try {
            // Si no hay búsqueda, mostramos un set reciente para que no esté vacío
            const endpoint = name ? `/cards?name=${encodeURIComponent(name)}` : '/sets/sv01';
            const response = await fetch(API_URL + endpoint);
            const data = await response.json();
            
            // La API devuelve .cards en sets o array directo en búsqueda
            const cards = data.cards || data.data || data;

            spinner.style.display = 'none';

            if (!cards || cards.length === 0) {
                grid.innerHTML = '<p class="text-center w-100">No se encontraron resultados.</p>';
                return;
            }

            cards.slice(0, 48).forEach(card => {
                if (card.image) {
                    const col = document.createElement('div');
                    col.className = 'col';
                    col.innerHTML = `
                        <div class="card card-container shadow-sm" onclick="showCardDetails('${card.id}')">
                            <img src="${card.image}/low.jpg" class="card-img-top" alt="${card.name}">
                            <div class="card-body p-2 text-center">
                                <small class="fw-bold">${card.name}</small>
                            </div>
                        </div>
                    `;
                    grid.appendChild(col);
                }
            });
        } catch (error) {
            spinner.style.display = 'none';
            grid.innerHTML = '<p class="text-danger text-center w-100">Error al conectar con la API.</p>';
        }
    }

    async function showCardDetails(id) {
        document.getElementById('modalBody').innerHTML = '<div class="spinner-border" role="status"></div>';
        modal.show();

        try {
            const res = await fetch(`${API_URL}/cards/${id}`);
            const card = await res.json();

            document.getElementById('modalTitle').innerText = card.name;
            let infoHtml = `
                <img src="${card.image}/high.jpg" class="img-fluid">
                <div class="text-start p-2">
                    <p><strong>Rareza:</strong> ${card.rarity || 'Desconocida'}</p>
                    <p><strong>Serie:</strong> ${card.set.name}</p>
                    <p><strong>Tipo:</strong> ${card.types ? card.types.join(', ') : 'N/A'}</p>
                    <p><strong>Descripción:</strong> ${card.description || 'Sin descripción disponible.'}</p>
                </div>
            `;
            document.getElementById('modalBody').innerHTML = infoHtml;
            document.getElementById('price-btn').href = `https://www.cardmarket.com/en/Pokemon/Products/Search?searchString=${encodeURIComponent(card.name)}`;
        } catch (err) {
            document.getElementById('modalBody').innerHTML = 'Error al cargar detalles.';
        }
    }

    document.getElementById('search-btn').onclick = () => {
        fetchCards(document.getElementById('search-input').value);
    };

    document.getElementById('search-input').onkeypress = (e) => {
        if (e.key === 'Enter') fetchCards(e.target.value);
    };

    // Carga inicial
    window.onload = () => fetchCards();
</script>

</body>
</html>


